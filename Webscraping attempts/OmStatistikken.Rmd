---
title: "Om statistikken"
output: pdf_document
---

```{r setup, warning=FALSE, echo=FALSE}
library(tidyverse)
library(xml2)
library(rvest)
```

## Om Statistikken

Hente ut Om statistikken fra hver statistikk-html-side.

```{r, eval=FALSE}
getwd() # sjekker path/working directory

# Pathen til statistikkene er "./Data/statistikk

filnavn <- list.files("./Data/statistikk") # lagre alle filnavnene i en str-liste
```

Nå som vi har alle filnavnene i en liste kan vi iterere gjennom disse, dele hver statistikk i seksjoner og lage datasett for hver statistikk.


Nå som vi har alle filnavnene i en liste kan vi iterere gjennom og lese:
Lager en tabell for hver av om statistikkene med disse oversiktene (disse tabellene burde bli en tabell (+ eventuelt tabell i tabell, slik at det er lettere å lese))


Har fjernet str_remove_all, for lettere lesning (hvis feil kommenter tilbake)
- Definisjoner
- Administrative opplysninger
- Bakgrunn
- Produksjon
- Nøyaktighet og pålitelighet
- Relevant dokumentasjon
- Om sesongjustering

"Definisjoner" = def,
"Administrative opplysninger" = adm,
"Bakgrunn" = bak,
"Produksjon" = prod,
"Feilkilder" = feil,
"Relevant_dokumentasjon" = reldok,
"Om_sesongjustering" = sesong
           
```{r}
#Creating empty data frame to be able to join each new to this
df <- data.frame("Statistikk"=character(),
                 "Definisjoner"=character(), 
                 "Administrative opplysninger"= character(), 
                 "Bakgrunn"=character(),
                 "Produksjon" = character(), 
                 "Feilkilder" = character(), 
                 "Relevant_dokumentasjon" = character(),
                 "Om_sesongjustering" = character()) 


for(i in filnavn){
  url <- paste0("./Data/statistikk/", i)

  page <- read_html(x = url, encoding = "UTF-8")
  
  def <- page %>%
    html_node('div[id="om-statistikken-definisjoner"]') %>% 
    # html_element('div[class="ssb-nested-accordion"]') %>% 
    html_text2()
    # try(html_elements('div[class="ssb-nested-accordion"]')) %>% 
    # html_text2() # %>% 
    # writeLines() %>%
    #str_remove_all(pattern = regex("\\n")) %>% 
    #str_remove_all(pattern = regex("\\r"))
  
  # funksjon <- function(def){
  #   out <- tryCatch(
  #     {
  #       message("This is the try part")
  #       
  #       html_elements('div[class="ssb-nested-accordion"]') %>% 
  #         html_text2()
  #       },
  #     error = function(e){
  #       return(NA)
  #     }
  #   )
  #   return(out)
  # }
  # 
  # def <- funksjon(def)

  adm <- page %>%
    html_node('div[id="om-statistikken-administrative_opplysninger"]') %>%
    #MERK! i motsetning til andre steder så skrives undertittelen "administrative opplysninger" med understrek i syntax, IKKE bindestrek! får feilmld om man bruker bindestrek her
    html_text2() #%>% 
    # writeLines() %>%
    # str_remove_all(pattern = regex("\\n")) %>% 
    # str_remove_all(pattern = regex("\\r"))

  bak <- page %>%
    html_node('div[id="om-statistikken-bakgrunn"]') %>%
    html_text2() #%>% 
    # writeLines() %>%
    # str_remove_all(pattern = regex("\\n")) %>% 
    # str_remove_all(pattern = regex("\\r"))

  prod <- page %>%
    html_node('div[id="om-statistikken-produksjon"]') %>%
    html_text2() #%>% 
    # writeLines() %>%
    # str_remove_all(pattern = regex("\\n")) %>% 
    # str_remove_all(pattern = regex("\\r"))

  feil <- page %>%
    html_node('div[id="om-statistikken-feilkilder"]') %>%
    html_text2() #%>% 
    # writeLines() %>%
    # str_remove_all(pattern = regex("\\n")) %>% 
    # str_remove_all(pattern = regex("\\r"))

  reldok <- page %>%
    html_node('div[id="om-statistikken-relevant-dokumentasjon"]') %>%
    html_text2() #%>% 
    # writeLines() %>%
    # str_remove_all(pattern = regex("\\n")) %>% 
    # str_remove_all(pattern = regex("\\r"))
  
  sesong <- page %>% 
    html_node('div[id="om-sesongjustering"]') %>% 
    html_text2()

navn_statistikk <- i
ny_statistikk <- data.frame(navn_statistikk, def, adm, bak, prod, feil, reldok, sesong)
#Using rbind() function to insert above observation in df
df <- rbind(df, ny_statistikk)
}

df$def[1]
```


## Telle antall NA per seksjon

Kun hvor hele seksjonen mangler, vi må gå dypere i teksten dersom vi vil finne kun delseksjoner innad hovedseksjonene som har mangler.

```{r}
# Antall statistikker per seksjon hvor hele seksjonen mangler
sum(is.na(df$def)) # 4
sum(is.na(df$adm)) # 1
sum(is.na(df$bak)) # 0
sum(is.na(df$prod)) # 1
sum(is.na(df$feil)) # 6
sum(is.na(df$reldok)) # 202
sum(is.na(df$sesong)) # 265
```

## Dele opp i sub-seksjoner

```{r}
# Definisjoner
test <- df %>%
  select(navn_statistikk, def) %>% 
  separate(def,
           c("def.begrep", "def.klass"),
           sep = "Standard klassifikasjoner")

# Administrative opplysninger
admopp <- df %>% 
  select(navn_statistikk, adm) %>% 
  separate(adm,
           c("adm", "adm.ansvarlig_seksjon"),
           sep = "Ansvarlig seksjon")

df$adm[1]
```


## Nynorsk

Nynorske statistikker har en seksjon som heter "definisjonar".

```{r}
# Alle nynorske statistikker:
nynorsk <- filter(df, grepl("Definisjonar", def))

nrow(nynorsk) # 46 statistikker
```

Men: vet at fire statistikker mangler "Definisjoner"-seksjonen totalt. Burde se etter nynorsk i "Bakgrunn"-seksjonen slik at jeg kan sjekke opp mot alle statistikkene.

```{r}
# UFERDIG

for(i in df){
  if(grepl("Definisjonar", df[i]$def)){
    df[i]$nynorsk <- 1
  }
  else {
    df[i]$nynorsk <- 0
  }
}
```

